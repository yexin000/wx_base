<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"  />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="x-dns-prefetch-control" content="on" />
    <link href="../../../css/style/base.css" rel="stylesheet" type="text/css">
    <link href="../../../css/style/common.css" rel="stylesheet" type="text/css">
    <link href="../../../css/style/index.css" rel="stylesheet" type="text/css">
    <link href="../../../css/style/banner.css" rel="stylesheet" type="text/css">
    <link href="../../../css/style/collect.css" rel="stylesheet" type="text/css">
    <link href="../../../css/style/weui.css" rel="stylesheet" type="text/css">
    <link href="../../../css/style/example.css" rel="stylesheet" type="text/css">
    <link href="../../../css/style/like.css?v=1.3" rel="stylesheet" type="text/css">
    <title></title>
    <style type="text/css">
      input::-webkit-input-placeholder{ /*WebKit browsers*/
        color: #888;
      }
      input::-ms-input-placeholder{ /*Internet Explorer*/
        color: #888;
      }
    </style>
  </head>
  <body style="height: auto;">
    <div class="auctionitem-search-container">
      <input class="like1" type="text" placeholder="请输入拍品名称" id="shoppingName">
      <button class="auctionitem-search-btn"> 搜索</button>
    </div>

    <div id="auctionItemDiv" class="table-content mystore-content-div" style="height: 100%;margin-bottom: 0.48rem;">
      <div id="auctionItemDataDiv" class="weui-loadmore weui-loadmore_line none" style="display: none;">
        <span class="weui-loadmore__tips">暂无数据</span>
      </div>
      <div id="auctionItemData" class="weui-grids" style="overflow: scroll;height: 100%;">

      </div>
    </div>

    <div id="loadingToast" style="opacity: 1; display: none;">
      <div class="weui-mask_transparent"></div>
      <div class="weui-toast">
        <i class="weui-loading weui-icon_toast"></i>
        <p class="weui-toast__content">数据加载中</p>
      </div>
    </div>
    <div>
      <div class="weui-mask" id="publishMask" style="opacity: 1; display: none;"></div>
      <div class="weui-actionsheet" id="publishActionsheet" style="background-color: transparent;">
        <div class="weui-flex">
          <div class="weui-flex__item">
            <a class="weui-grid publish-item" onclick="javascript:toCreateAuction();">
              <div class="weui-grid__icon" style="width: 54px;height: 54px;">
                <img style="width: 60px;height: 54px;" src="/weixin/images/lh/add-auction-icon.png" alt="">
              </div>
              <p class="weui-grid__label" style="color: white;font-size: 12px;">创建专场拍卖</p>
            </a>
          </div>
          <div class="weui-flex__item">
            <a class="weui-grid publish-item" onclick="javascript:toUpload(0);">
              <div class="weui-grid__icon" style="width: 54px;height: 54px;">
                <img style="width: 60px;height: 54px;" src="/weixin/images/lh/create-auctionitem-icon.png" alt="">
              </div>
              <p class="weui-grid__label" style="color: white;font-size: 12px;">创建拍品</p>
            </a>
          </div>
          <div class="weui-flex__item">
            <a class="weui-grid publish-item" onclick="javascript:toUpload(1);">
              <div class="weui-grid__icon" style="width: 54px;height: 54px;">
                <img style="width: 60px;height: 54px;" src="/weixin/images/lh/create-goods-icon.png" alt="">
              </div>
              <p class="weui-grid__label" style="color: white;font-size: 12px;">创建商品</p>
            </a>
          </div>
        </div>
        <div class="weui-flex">
          <div class="weui-flex__item">
            <a class="weui-grid publish-item" onclick="javascript:toUpload(2);">
              <div class="weui-grid__icon" style="width: 54px;height: 54px;">
                <img style="width: 60px;height: 54px;" src="/weixin/images/lh/create-non-sale-icon.png" alt="">
              </div>
              <p class="weui-grid__label" style="color: white;font-size: 12px;">创建非卖品</p>
            </a>
          </div>
          <div class="weui-flex__item">
            <a class="weui-grid publish-item" onclick="javascript:toMyStore();">
              <div class="weui-grid__icon" style="width: 54px;height: 54px;">
                <img style="width: 60px;height: 54px;" src="/weixin/images/lh/my-store-icon.png" alt="">
              </div>
              <p class="weui-grid__label" style="color: white;font-size: 12px;">我的店铺</p>
            </a>
          </div>
        </div>
        <div class="weui-actionsheet__action" style="background-color: transparent;border-top: 1px solid #ffffff;">
          <div class="weui-actionsheet__cell" onclick="javascript:hideActionSheet()"><i class="publish-icon"></i></div>
        </div>
      </div>
    </div>
    <footer class="footer-com">
      <table width="100%" cellpadding="0" cellspacing="0">
        <tr>
          <td onclick="window.location.href='index.html?v=1.3'"><img src="../../../images/lh/footer-index-n.png" ><br/>首页</td>
          <td class="active"><img src="../../../images/lh/footer-classify-s.png" alt=""><br/>拍卖</td>
          <td onclick="javascript:showPublish();"><img src="../../../images/lh/footer-publish-n.png" alt=""><br/>发布</td>
          <td onclick="window.location.href='market.html?v=1.3'"><img src="../../../images/lh/footer-shopping-n.png" alt=""><br/>商城</td>
          <td onclick="window.location.href='mine.html?v=1.3'"><img src="../../../images/lh/footer-user-n.png" alt=""><br/>我的</td>
        </tr>
      </table>
    </footer>
    <script type="text/javascript" src="../../../js/lh/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="../../../js/lh/layout.js"></script>
    <script type="text/javascript" src="../../../js/lh/common.js"></script>
    <script type="text/javascript">
      var curPage = 1;
      var rows = 6;
      $(function(){
        loadAuctionItems();
        $(".auctionitem-search-btn").click(function () {
          curPage = 1;
          $('#loadMore').remove();
          $("#auctionItemData").empty();
          loadAuctionItems($("#shoppingName").val());
        });
      });
      
      function loadAuctionItems(name) {
        $('#loadingToast').show();
        var AuctionItemModel = {};
        AuctionItemModel.name = name;
        AuctionItemModel.attribute = '0';
        AuctionItemModel.status = '3';
        AuctionItemModel.page = curPage;
        AuctionItemModel.rows = rows;
        var url= '/weixin/auctionItem/ajaxDataList.do';
        $.ajax({
          url: url,
          type: 'post',
          data: JSON.stringify(AuctionItemModel) ,
          dataType: 'JSON',
          contentType : "application/json;charset=utf-8",
          cache: false,
          success:function(data){
            $('#loadingToast').hide();
            var dataList = data.rows;
            var total = data.total;
            if(dataList.length> 0) {
              for(var i = 0; i < dataList.length; i ++) {
                var str = "";
                var coverImage = 'foreground/images/no-image.jpg';
                if(dataList[i].resList != null && dataList[i].resList.length > 0) {
                  coverImage = dataList[i].resList[0].path;
                }

                var price = dataList[i].curPrice;
                if(price <= 0) {
                  price = dataList[i].startPrice;
                }
                str += '<a href="javascript:toAuctionItemDetail(\''+dataList[i].id+'\',\'' + dataList[i].attribute + '\');" class="weui-grid" style="position: initial;padding: 10px 0px;">'
                      +   '<div class="mystore-auctionitem-div">'
                      +     '<div class="weui-grid__icon" style="width: 90%;height: 150px;">'
                      +       '<img src="' + hostPath + coverImage + '" alt="">'
                      +     '</div>'
                      +     '<p class="weui-grid__label auctionitem-auctionitem-label">名称:' + dataList[i].name + '</p>'
                      +     '<p class="weui-grid__label auctionitem-auctionitem-label">作者:' + dataList[i].uploader + '</p>'
                      +     '<p class="weui-grid__label auctionitem-auctionitem-label">价格:' + price + '</p>'
                      +     '<p class="weui-grid__label auctionitem-auctionitem-label">结束时间:' + dataList[i].endTime + '</p>'
                      +   '</div>'
                      +'</a>';
                $("#auctionItemData").append(str);
              }
              if(total > curPage * rows) {
                $("#auctionItemDiv").append('<a href="javascript:$(\'#loadMore\').remove();loadAuctionItems(\''+ name + '\');" id="loadMore" class="weui-btn weui-btn_default weui-btn_loading" style="background-color: #363636;color: white;"> 点击加载更多</a>');
              }
              curPage ++;
            }
          }
        })
      }
    </script>
  </body>
</html>